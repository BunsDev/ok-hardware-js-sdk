{"version":3,"sources":["../../../node_modules/@onekeyfe/hd-transport-http/dist/index.js","../../../node_modules/@onekeyfe/hd-transport-webusb/dist/index.js","../../../node_modules/@onekeyfe/hd-transport-lowlevel/dist/index.js","../../../node_modules/@onekeyfe/hd-common-connect-sdk/dist/index.js"],"names":["transport","hdShared","axios","_interopDefaultLegacy","e","transport__default","axios__default","__awaiter","thisArg","_arguments","P","generator","Promise","resolve","reject","fulfilled","value","step","next","rejected","result","done","then","apply","contentType","body","parseResult","text","JSON","parse","Error","request","options","_a","this","fetchOptions","url","method","data","stringify","withCredentials","headers","timeout","undefined","transformResponse","res","status","resJson","error","HardwareError","errorCode","HardwareErrorCode","NetworkError","message","interceptors","use","config","_b","window","startsWith","Origin","console","log","Object","assign","check","buildOne","receiveOne","parseConfigure","module","exports","configured","stopped","ERRORS","TypedError","logger","Log","_silentInit","infoS","info","version","signedData","messages","_messages","old","devicesS","_post","devices","input","previousStr","previous","path","acquireS","_acquireMixed","acquire","session","onclose","name","TransportNotConfigured","LogBlockCommand","has","debug","outData","toString","resData","jsonData","call","ByteBuffer","ByteBuffer__default","buildEncodeBuffers","decodeProtocol","ONEKEY_FILTER","vendorId","productId","_lastDevices","configurationId","endpointId","interfaceId","usb","navigator","RuntimeError","_getDeviceList","onekeyDevices","getDevices","filter","dev","isOneKey","some","desc","hasSerialNumber","serialNumber","length","map","device","connect","find","d","first","i","setTimeout","_connectIn","_findDevice","open","selectConfiguration","reset","claimInterface","DeviceNotFound","encodeBuffers","buffer","newArray","Uint8Array","set","opened","transferOut","_receive","firstPacket","transferIn","firstData","slice","typeId","restBuffer","decodeChunked","lengthWithHeader","Number","decoded","writeUint16","writeUint32","append","offset","byteLength","warn","toBuffer","Buffer","from","releaseInterface","close","requestDevice","filters","buildBuffers","plugin","emitter","init","enumerate","uuid","LowlevelTrasnportConnectError","disconnect","buffers","o","send","BleWriteCharacteristicError","reason","response","receive","defineProperty","HardwareSdk","HttpTransport","WebusbTransport","LowlevelTransport","HardwareSdk__default","HttpTransport__default","WebusbTransport__default","LowlevelTransport__default","__assign","t","s","n","arguments","p","prototype","hasOwnProperty","__generator","f","y","g","_","label","sent","trys","ops","verb","Symbol","iterator","v","op","TypeError","pop","push","ReflectOwnKeys","events","R","Reflect","ReflectApply","target","receiver","args","Function","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","concat","NumberIsNaN","isNaN","EventEmitter","once","errorListener","err","removeListener","resolver","eventTargetAgnosticAddListener","handler","flags","on","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","listener","_getMaxListeners","that","_addListener","type","prepend","m","existing","warning","create","newListener","emit","unshift","warned","w","String","count","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","bind","_listeners","unwrap","evlistener","arr","ret","Array","unwrapListeners","arrayClone","listenerCount","copy","addEventListener","wrapListener","arg","removeEventListener","enumerable","get","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","er","context","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","index","spliceOne","off","removeAllListeners","key","keys","rawListeners","eventNames","_core","eventEmitter","getLogger","LoggerNames","HdCommonConnectSdk","_settings","parseConnectSettings","_messageID","messagePromises","handleMessage","event","LOG_EVENT","UI_EVENT","payload","FIRMWARE_EVENT","DEVICE_EVENT","DEVICE","CONNECT","DISCONNECT","FEATURES","SUPPORT_FEATURES","includes","postMessage","usePromise","createDeferred","id","HardwareCommonConnectSdk","settings","Transport","error_1","env","enableLog","initCore","CORE_EVENT","setLoggerPostMessage","createErrorMessage","params","error_2","IFRAME","CALL","CallMethodNotResponse","cancel","connectId","CANCEL","dispose","uiResponse","NotInitialized","updateSettings"],"mappings":"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","file":"static/js/2.11e2f02b.chunk.js","sourcesContent":["'use strict';\n\nvar transport = require('@onekeyfe/hd-transport');\nvar hdShared = require('@onekeyfe/hd-shared');\nvar axios = require('axios');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar transport__default = /*#__PURE__*/_interopDefaultLegacy(transport);\nvar axios__default = /*#__PURE__*/_interopDefaultLegacy(axios);\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nfunction contentType(body) {\n    if (typeof body === 'string') {\n        return 'text/plain';\n    }\n    return 'application/json';\n}\nfunction wrapBody(body) {\n    if (typeof body === 'string') {\n        return body;\n    }\n    return JSON.stringify(body);\n}\nfunction parseResult(text) {\n    try {\n        const result = JSON.parse(text);\n        if (typeof result !== 'object') {\n            throw new Error('Invalid response');\n        }\n        return result;\n    }\n    catch (e) {\n        return text;\n    }\n}\nfunction request(options) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n        const fetchOptions = {\n            url: options.url,\n            method: options.method,\n            data: wrapBody(options.body),\n            withCredentials: false,\n            headers: {\n                'Content-Type': contentType(options.body == null ? '' : options.body),\n            },\n            timeout: (_a = options.timeout) !== null && _a !== void 0 ? _a : undefined,\n            transformResponse: data => data,\n        };\n        const res = yield axios__default[\"default\"].request(fetchOptions);\n        if (+res.status === 200) {\n            return parseResult(res.data);\n        }\n        const resJson = parseResult(res.data);\n        if (typeof resJson === 'object' && resJson != null && resJson.error != null) {\n            throw new hdShared.HardwareError({\n                errorCode: hdShared.HardwareErrorCode.NetworkError,\n                message: resJson.error,\n            });\n        }\n        else {\n            throw new hdShared.HardwareError({ errorCode: hdShared.HardwareErrorCode.NetworkError, message: res.data });\n        }\n    });\n}\naxios__default[\"default\"].interceptors.request.use(config => {\n    var _a, _b;\n    if (typeof window !== 'undefined') {\n        return config;\n    }\n    if ((_a = config.url) === null || _a === void 0 ? void 0 : _a.startsWith('http://localhost:21320')) {\n        if (!((_b = config === null || config === void 0 ? void 0 : config.headers) === null || _b === void 0 ? void 0 : _b.Origin)) {\n            console.log('set node request origin');\n            config.headers = Object.assign(Object.assign({}, config.headers), { Origin: 'https://jssdk.onekey.so' });\n        }\n    }\n    return config;\n});\n\nconst DEFAULT_URL = 'http://localhost:21320';\n\nconst { check, buildOne, receiveOne, parseConfigure } = transport__default[\"default\"];\nclass HttpTransport {\n    constructor(url) {\n        this.configured = false;\n        this.stopped = false;\n        this.url = url == null ? DEFAULT_URL : url;\n    }\n    _post(options) {\n        if (this.stopped) {\n            return Promise.reject(hdShared.ERRORS.TypedError('Transport stopped.'));\n        }\n        return request(Object.assign(Object.assign({}, options), { method: 'POST', url: this.url + options.url }));\n    }\n    init(logger) {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.Log = logger;\n            const bridgeVersion = yield this._silentInit();\n            return bridgeVersion;\n        });\n    }\n    _silentInit() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const infoS = yield request({\n                url: this.url,\n                method: 'POST',\n                timeout: 3000,\n            });\n            const info = check.info(infoS);\n            return info.version;\n        });\n    }\n    configure(signedData) {\n        const messages = parseConfigure(signedData);\n        this.configured = true;\n        this._messages = messages;\n    }\n    listen(old) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (old === null) {\n                throw hdShared.ERRORS.TypedError('Http-Transport does not support listen without previous.');\n            }\n            const devicesS = yield this._post({\n                url: '/listen',\n                body: old,\n            });\n            const devices = check.devices(devicesS);\n            return devices;\n        });\n    }\n    enumerate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const devicesS = yield this._post({ url: '/enumerate' });\n            const devices = check.devices(devicesS);\n            return devices;\n        });\n    }\n    _acquireMixed(input) {\n        const previousStr = input.previous == null ? 'null' : input.previous;\n        const url = `/acquire/${input.path}/${previousStr}`;\n        return this._post({ url });\n    }\n    acquire(input) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const acquireS = yield this._acquireMixed(input);\n            return check.acquire(acquireS);\n        });\n    }\n    release(session, onclose) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const res = this._post({\n                url: `/release/${session}`,\n            });\n            if (onclose) {\n                return;\n            }\n            yield res;\n        });\n    }\n    call(session, name, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._messages == null) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.TransportNotConfigured);\n            }\n            const messages = this._messages;\n            if (transport.LogBlockCommand.has(name)) {\n                this.Log.debug('call-', ' name: ', name);\n            }\n            else {\n                this.Log.debug('call-', ' name: ', name, ' data: ', data);\n            }\n            const o = buildOne(messages, name, data);\n            const outData = o.toString('hex');\n            const resData = yield this._post({\n                url: `/call/${session}`,\n                body: outData,\n                timeout: name === 'Initialize' ? 10000 : undefined,\n            });\n            if (typeof resData !== 'string') {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.NetworkError, 'Returning data is not string.');\n            }\n            const jsonData = receiveOne(messages, resData);\n            return check.call(jsonData);\n        });\n    }\n    post(session, name, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._messages == null) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.TransportNotConfigured);\n            }\n            const messages = this._messages;\n            const outData = buildOne(messages, name, data).toString('hex');\n            yield this._post({\n                url: `/post/${session}`,\n                body: outData,\n            });\n        });\n    }\n    read(session) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._messages == null) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.TransportNotConfigured);\n            }\n            const messages = this._messages;\n            const resData = yield this._post({\n                url: `/read/${session}`,\n            });\n            if (typeof resData !== 'string') {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.NetworkError, 'Returning data is not string.');\n            }\n            const jsonData = receiveOne(messages, resData);\n            return check.call(jsonData);\n        });\n    }\n    requestDevice() {\n        return Promise.reject();\n    }\n    stop() {\n        this.stopped = true;\n    }\n    cancel() {\n        this.Log.debug('canceled');\n    }\n}\n\nmodule.exports = HttpTransport;\n","'use strict';\n\nvar transport = require('@onekeyfe/hd-transport');\nvar hdShared = require('@onekeyfe/hd-shared');\nvar ByteBuffer = require('bytebuffer');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar transport__default = /*#__PURE__*/_interopDefaultLegacy(transport);\nvar ByteBuffer__default = /*#__PURE__*/_interopDefaultLegacy(ByteBuffer);\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nconst { parseConfigure, buildEncodeBuffers, decodeProtocol, receiveOne, check } = transport__default[\"default\"];\nconst ONEKEY_FILTER = [\n    { vendorId: 0x1209, productId: 0x53c0 },\n    { vendorId: 0x1209, productId: 0x53c1 },\n];\nconst CONFIGURATION_ID = 1;\nconst INTERFACE_ID = 0;\nconst ENDPOINT_ID = 1;\nconst PACKET_SIZE = 64;\nconst HEADER_LENGTH = 6;\nclass WebUsbTransport {\n    constructor() {\n        this.stopped = false;\n        this.configured = false;\n        this._lastDevices = [];\n        this.configurationId = CONFIGURATION_ID;\n        this.endpointId = ENDPOINT_ID;\n        this.interfaceId = INTERFACE_ID;\n    }\n    init(logger) {\n        this.Log = logger;\n        const { usb } = navigator;\n        if (!usb) {\n            throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.RuntimeError, 'WebUSB is not supported by current browsers');\n        }\n        this.usb = usb;\n    }\n    configure(signedData) {\n        const messages = parseConfigure(signedData);\n        this.configured = true;\n        this._messages = messages;\n    }\n    enumerate() {\n        return __awaiter(this, void 0, void 0, function* () {\n            const list = yield this._getDeviceList();\n            return list;\n        });\n    }\n    _getDeviceList() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.usb)\n                return [];\n            const devices = yield this.usb.getDevices();\n            const onekeyDevices = devices.filter(dev => {\n                const isOneKey = ONEKEY_FILTER.some(desc => dev.vendorId === desc.vendorId && dev.productId === desc.productId);\n                const hasSerialNumber = typeof dev.serialNumber === 'string' && dev.serialNumber.length > 0;\n                return isOneKey && hasSerialNumber;\n            });\n            this._lastDevices = onekeyDevices.map(device => ({\n                path: device.serialNumber,\n                device,\n            }));\n            return this._lastDevices;\n        });\n    }\n    acquire(input) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!input.path)\n                return;\n            try {\n                yield this.connect((_a = input.path) !== null && _a !== void 0 ? _a : '', true);\n                return yield Promise.resolve(input.path);\n            }\n            catch (e) {\n                this.Log.debug('acquire error: ', e);\n                throw e;\n            }\n        });\n    }\n    _findDevice(path) {\n        const device = this._lastDevices.find(d => d.path === path);\n        if (device == null) {\n            throw new Error('Action was interrupted.');\n        }\n        return device.device;\n    }\n    connect(path, first) {\n        return __awaiter(this, void 0, void 0, function* () {\n            for (let i = 0; i < 5; i++) {\n                if (i > 0) {\n                    yield new Promise(resolve => setTimeout(() => resolve(undefined), i * 200));\n                }\n                try {\n                    return yield this._connectIn(path, first);\n                }\n                catch (e) {\n                    if (i === 4) {\n                        throw e;\n                    }\n                }\n            }\n        });\n    }\n    _connectIn(path, first) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const device = yield this._findDevice(path);\n            yield device.open();\n            if (first) {\n                yield device.selectConfiguration(this.configurationId);\n                try {\n                    yield device.reset();\n                }\n                catch (error) {\n                }\n            }\n            yield device.claimInterface(this.interfaceId);\n        });\n    }\n    call(path, name, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._messages == null) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.TransportNotConfigured);\n            }\n            const device = yield this._findDevice(path);\n            if (!device) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.DeviceNotFound);\n            }\n            const messages = this._messages;\n            if (transport.LogBlockCommand.has(name)) {\n                this.Log.debug('call-', ' name: ', name);\n            }\n            else {\n                this.Log.debug('call-', ' name: ', name, ' data: ', data);\n            }\n            const encodeBuffers = buildEncodeBuffers(messages, name, data);\n            for (const buffer of encodeBuffers) {\n                const newArray = new Uint8Array(PACKET_SIZE);\n                newArray[0] = 63;\n                newArray.set(new Uint8Array(buffer), 1);\n                if (!device.opened) {\n                    yield this.connect(path, false);\n                }\n                yield device.transferOut(this.endpointId, newArray);\n            }\n            const resData = yield this._receive(path);\n            if (typeof resData !== 'string') {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.NetworkError, 'Returning data is not string.');\n            }\n            const jsonData = receiveOne(messages, resData);\n            return check.call(jsonData);\n        });\n    }\n    _receive(path) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            const device = yield this._findDevice(path);\n            if (!device.opened) {\n                yield this.connect(path, false);\n            }\n            const firstPacket = yield device.transferIn(this.endpointId, PACKET_SIZE);\n            const firstData = (_a = firstPacket.data) === null || _a === void 0 ? void 0 : _a.buffer.slice(1);\n            const { length, typeId, restBuffer } = decodeProtocol.decodeChunked(firstData);\n            const lengthWithHeader = Number(length + HEADER_LENGTH);\n            const decoded = new ByteBuffer__default[\"default\"](lengthWithHeader);\n            decoded.writeUint16(typeId);\n            decoded.writeUint32(length);\n            if (length) {\n                decoded.append(restBuffer);\n            }\n            while (decoded.offset < lengthWithHeader) {\n                const res = yield device.transferIn(this.endpointId, PACKET_SIZE);\n                if (!res.data) {\n                    throw new Error('no data');\n                }\n                if (res.data.byteLength === 0) {\n                    console.warn('empty data');\n                }\n                const buffer = res.data.buffer.slice(1);\n                if (lengthWithHeader - decoded.offset >= PACKET_SIZE) {\n                    decoded.append(buffer);\n                }\n                else {\n                    decoded.append(buffer.slice(0, lengthWithHeader - decoded.offset));\n                }\n            }\n            decoded.reset();\n            const result = decoded.toBuffer();\n            return Buffer.from(result).toString('hex');\n        });\n    }\n    release(path) {\n        return __awaiter(this, void 0, void 0, function* () {\n            const device = yield this._findDevice(path);\n            yield device.releaseInterface(this.interfaceId);\n            yield device.close();\n        });\n    }\n    requestDevice() {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.usb)\n                return;\n            try {\n                const device = yield this.usb.requestDevice({ filters: ONEKEY_FILTER });\n                return device;\n            }\n            catch (e) {\n                this.Log.debug('requestDevice error: ', e);\n            }\n        });\n    }\n}\n\nmodule.exports = WebUsbTransport;\n","'use strict';\n\nvar hdShared = require('@onekeyfe/hd-shared');\nvar transport = require('@onekeyfe/hd-transport');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar transport__default = /*#__PURE__*/_interopDefaultLegacy(transport);\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\n\nconst { check, buildBuffers, receiveOne, parseConfigure } = transport__default[\"default\"];\nclass LowlevelTransport {\n    constructor() {\n        this.configured = false;\n        this.plugin = {};\n    }\n    init(logger, emitter, plugin) {\n        this.Log = logger;\n        this.emitter = emitter;\n        this.plugin = plugin;\n        this.plugin.init();\n    }\n    configure(signedData) {\n        const messages = parseConfigure(signedData);\n        this.configured = true;\n        this._messages = messages;\n    }\n    listen() {\n    }\n    enumerate() {\n        return this.plugin.enumerate();\n    }\n    acquire(input) {\n        var _a;\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                yield this.plugin.connect(input.uuid);\n                return { uuid: input.uuid };\n            }\n            catch (error) {\n                this.Log.debug('lowlelvel transport connect error: ', error);\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.LowlevelTrasnportConnectError, (_a = error.message) !== null && _a !== void 0 ? _a : error);\n            }\n        });\n    }\n    release(uuid) {\n        return __awaiter(this, void 0, void 0, function* () {\n            try {\n                yield this.plugin.disconnect(uuid);\n                return true;\n            }\n            catch (error) {\n                this.Log.debug('lowlelvel transport disconnect error: ', error);\n                return false;\n            }\n        });\n    }\n    call(uuid, name, data) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._messages === null || !this._messages) {\n                throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.TransportNotConfigured);\n            }\n            const messages = this._messages;\n            if (transport.LogBlockCommand.has(name)) {\n                this.Log.debug('lowlevel-transport', 'call-', ' name: ', name);\n            }\n            else {\n                this.Log.debug('lowlevel-transport', 'call-', ' name: ', name, ' data: ', data);\n            }\n            const buffers = buildBuffers(messages, name, data);\n            for (const o of buffers) {\n                const outData = o.toString('hex');\n                this.Log.debug('send hex strting: ', outData);\n                try {\n                    yield this.plugin.send(uuid, outData);\n                }\n                catch (e) {\n                    this.Log.debug('lowlevel transport send error: ', e);\n                    throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.BleWriteCharacteristicError, e.reason);\n                }\n            }\n            try {\n                const response = yield this.plugin.receive();\n                if (typeof response !== 'string') {\n                    throw new Error('Returning data is not string');\n                }\n                this.Log.debug('receive data: ', response);\n                const jsonData = receiveOne(messages, response);\n                return check.call(jsonData);\n            }\n            catch (e) {\n                this.Log.error('lowlevel call error: ', e);\n                throw e;\n            }\n        });\n    }\n    cancel() {\n        this.Log.debug('lowlevel-transport', 'cancel');\n    }\n}\n\nmodule.exports = LowlevelTransport;\n","'use strict';\n\nObject.defineProperty(exports, '__esModule', { value: true });\n\nvar HardwareSdk = require('@onekeyfe/hd-core');\nvar hdShared = require('@onekeyfe/hd-shared');\nvar HttpTransport = require('@onekeyfe/hd-transport-http');\nvar WebusbTransport = require('@onekeyfe/hd-transport-webusb');\nvar LowlevelTransport = require('@onekeyfe/hd-transport-lowlevel');\n\nfunction _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }\n\nvar HardwareSdk__default = /*#__PURE__*/_interopDefaultLegacy(HardwareSdk);\nvar HttpTransport__default = /*#__PURE__*/_interopDefaultLegacy(HttpTransport);\nvar WebusbTransport__default = /*#__PURE__*/_interopDefaultLegacy(WebusbTransport);\nvar LowlevelTransport__default = /*#__PURE__*/_interopDefaultLegacy(LowlevelTransport);\n\n/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nfunction __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\n\nvar events = {exports: {}};\n\nvar R = typeof Reflect === 'object' ? Reflect : null;\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  };\n\nvar ReflectOwnKeys;\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys;\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n};\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nevents.exports = EventEmitter;\nevents.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    }\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n\nvar eventEmitter = new events.exports();\nvar Log = HardwareSdk.getLogger(HardwareSdk.LoggerNames.HdCommonConnectSdk);\nvar _core;\nvar _settings = HardwareSdk.parseConnectSettings();\nvar _messageID = 0;\nvar messagePromises = {};\nvar dispose = function () {\n    eventEmitter.removeAllListeners();\n    _settings = HardwareSdk.parseConnectSettings();\n};\nvar uiResponse = function (response) {\n    if (!_core) {\n        throw hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.NotInitialized);\n    }\n    var type = response.type, payload = response.payload;\n    _core.handleMessage({ event: HardwareSdk.UI_EVENT, type: type, payload: payload });\n};\nvar cancel = function (connectId) {\n    if (_core === undefined)\n        return;\n    _core.handleMessage({ event: HardwareSdk.IFRAME.CANCEL, type: HardwareSdk.IFRAME.CANCEL, payload: { connectId: connectId } });\n};\nfunction handleMessage(message) {\n    var event = message.event;\n    if (!_core) {\n        return;\n    }\n    if (event !== HardwareSdk.LOG_EVENT) {\n        Log.debug('hd-common-connect-sdk handleMessage', message);\n    }\n    switch (event) {\n        case HardwareSdk.UI_EVENT:\n            // pass UI event up\n            eventEmitter.emit(message.event, message);\n            eventEmitter.emit(message.type, message.payload);\n            break;\n        case HardwareSdk.LOG_EVENT:\n        case HardwareSdk.FIRMWARE_EVENT:\n            eventEmitter.emit(message.event, message);\n            break;\n        case HardwareSdk.DEVICE_EVENT:\n            if ([HardwareSdk.DEVICE.CONNECT, HardwareSdk.DEVICE.DISCONNECT, HardwareSdk.DEVICE.FEATURES, HardwareSdk.DEVICE.SUPPORT_FEATURES].includes(message.type)) {\n                eventEmitter.emit(message.type, message.payload);\n            }\n            break;\n        default:\n            Log.log('No need to be captured message', message.event);\n    }\n}\nfunction postMessage(message, usePromise) {\n    if (usePromise === void 0) { usePromise = true; }\n    return __awaiter(this, void 0, void 0, function () {\n        var response;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!_core) {\n                        throw hdShared.ERRORS.TypedError('postMessage: _core not found');\n                    }\n                    if (!usePromise) return [3 /*break*/, 2];\n                    _messageID++;\n                    messagePromises[_messageID] = hdShared.createDeferred();\n                    return [4 /*yield*/, _core.handleMessage(__assign(__assign({}, message), { id: \"\".concat(_messageID) }))];\n                case 1:\n                    response = _a.sent();\n                    // return promise;\n                    return [2 /*return*/, response];\n                case 2:\n                    _core.handleMessage(message);\n                    return [2 /*return*/];\n            }\n        });\n    });\n}\nvar init = function (settings, _, plugin) { return __awaiter(void 0, void 0, void 0, function () {\n    var Transport, error_1;\n    var _a;\n    return __generator(this, function (_b) {\n        switch (_b.label) {\n            case 0:\n                _settings = __assign(__assign(__assign({}, _settings), settings), { env: (_a = settings.env) !== null && _a !== void 0 ? _a : 'node' });\n                HardwareSdk.enableLog(!!settings.debug);\n                Log.debug('init');\n                _b.label = 1;\n            case 1:\n                _b.trys.push([1, 3, , 4]);\n                console.log(_settings.env);\n                Transport = void 0;\n                switch (_settings.env) {\n                    case 'webusb':\n                        Transport = WebusbTransport__default[\"default\"];\n                        break;\n                    case 'lowlevel':\n                        Transport = LowlevelTransport__default[\"default\"];\n                        break;\n                    default:\n                        Transport = HttpTransport__default[\"default\"];\n                }\n                return [4 /*yield*/, HardwareSdk.initCore(_settings, Transport, plugin)];\n            case 2:\n                _core = _b.sent();\n                _core === null || _core === void 0 ? void 0 : _core.on(HardwareSdk.CORE_EVENT, handleMessage);\n                HardwareSdk.setLoggerPostMessage(handleMessage);\n                return [2 /*return*/, true];\n            case 3:\n                error_1 = _b.sent();\n                Log.error(HardwareSdk.createErrorMessage(error_1));\n                return [2 /*return*/, false];\n            case 4: return [2 /*return*/];\n        }\n    });\n}); };\nvar call = function (params) { return __awaiter(void 0, void 0, void 0, function () {\n    var response, error_2;\n    return __generator(this, function (_a) {\n        switch (_a.label) {\n            case 0:\n                Log.debug('call: ', params);\n                _a.label = 1;\n            case 1:\n                _a.trys.push([1, 3, , 4]);\n                return [4 /*yield*/, postMessage({ event: HardwareSdk.IFRAME.CALL, type: HardwareSdk.IFRAME.CALL, payload: params })];\n            case 2:\n                response = _a.sent();\n                if (response) {\n                    Log.debug('response: ', response);\n                    return [2 /*return*/, response];\n                }\n                return [2 /*return*/, HardwareSdk.createErrorMessage(hdShared.ERRORS.TypedError(hdShared.HardwareErrorCode.CallMethodNotResponse))];\n            case 3:\n                error_2 = _a.sent();\n                Log.error('__call error: ', error_2);\n                return [2 /*return*/, HardwareSdk.createErrorMessage(error_2)];\n            case 4: return [2 /*return*/];\n        }\n    });\n}); };\nvar updateSettings = function () { return Promise.resolve(true); };\nvar HardwareCommonConnectSdk = HardwareSdk__default[\"default\"]({\n    eventEmitter: eventEmitter,\n    init: init,\n    call: call,\n    cancel: cancel,\n    dispose: dispose,\n    uiResponse: uiResponse,\n    updateSettings: updateSettings\n});\n\nexports[\"default\"] = HardwareCommonConnectSdk;\nexports.messagePromises = messagePromises;\n"],"sourceRoot":""}