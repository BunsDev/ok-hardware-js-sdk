(this.webpackJsonp=this.webpackJsonp||[]).push([[4],{139:function(e,n,t){"use strict";t.r(n),t.d(n,"getHardwareSDKInstance",(function(){return f})),t.d(n,"HardwareSDK",(function(){return r}));var r,a=t(9),u=t.n(a),c=t(354),s=t.n(c),o=t(7),i=function(){var e=arguments;return u.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(e.length>0&&void 0!==e[0]&&e[0])){n.next=5;break}return n.next=4,u.a.awrap(t.e(2).then(t.t.bind(null,750,7)));case 4:return n.abrupt("return",n.sent.default);case 5:return n.next=7,u.a.awrap(t.e(0).then(t.t.bind(null,751,7)));case 7:return n.abrupt("return",n.sent.default.HardwareWebSdk);case 8:case"end":return n.stop()}}),null,null,null,Promise)},l=!1,f=s()((function(){return u.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var t,a;return u.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(t=!1,!l){c.next=4;break}return e({HardwareSDK:r,HardwareLowLevelSDK:void 0,useLowLevelApi:t}),c.abrupt("return");case 4:return a={debug:!0,fetchConfig:!0},c.next=7,u.a.awrap(i());case 7:return r=c.sent,console.log(r),"web"===o.default.OS&&(a.connectSrc="https://jssdk.onekey.so/0.3.29/",a.env="web",a.preRelease=!1),c.prev=10,c.next=13,u.a.awrap(r.init(a));case 13:console.log("HardwareSDK initialized success"),l=!0,e({HardwareSDK:r,HardwareLowLevelSDK:void 0,useLowLevelApi:t}),c.next=21;break;case 18:c.prev=18,c.t0=c.catch(10),n(c.t0);case 21:case"end":return c.stop()}}),null,null,[[10,18]],Promise)})));case 1:case"end":return e.stop()}}),null,null,null,Promise)}),{promise:!0,max:1})},383:function(e,n,t){e.exports=t(703)},384:function(e,n,t){(function(e,n,r){if("undefined"===typeof e)n.process=t(13);else{var a=t(13);for(var u in a)u in e||(e[u]=a[u])}e.browser=!1,"undefined"===typeof r&&(n.Buffer=t(12).Buffer);"undefined"!==typeof localStorage&&(localStorage.debug=""),t(387)}).call(this,t(13),t(14),t(12).Buffer)},390:function(e,n){},392:function(e,n){},401:function(e,n){},403:function(e,n){},429:function(e,n){},431:function(e,n){},432:function(e,n){},437:function(e,n){},439:function(e,n){},445:function(e,n){},447:function(e,n){},466:function(e,n){},478:function(e,n){},481:function(e,n){},581:function(e,n){},589:function(e,n){},607:function(e,n){},609:function(e,n){},625:function(e,n){},703:function(e,n,t){"use strict";t.r(n);t(384);var r=t(717),a=t(0),u=t.n(a),c=t(716),s=t(715),o=t(3),i=t(7),l=t(2),f=t(57),p=t(103),d=t(24),b=t(21),v=u.a.lazy((function(){return Promise.all([t.e(1),t.e(3),t.e(8)]).then(t.bind(null,743))})),h=u.a.lazy((function(){return Promise.all([t.e(1),t.e(3),t.e(7)]).then(t.bind(null,749))}));function x(){var e=Object(d.useNavigation)();return Object(b.jsxs)(l.default,{style:y.container,children:[Object(b.jsx)(p.default,{title:"Mock Screen",onPress:function(){return e.push("Mock")}}),Object(b.jsx)(a.Suspense,{fallback:Object(b.jsx)(f.default,{children:"Loading..."}),children:"web"===i.default.OS?Object(b.jsx)(v,{}):Object(b.jsx)(h,{})})]})}var w,y=o.default.create({container:{display:"flex",backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:32}}),j=t(6),g=t.n(j),m=t(37),k=t.n(m),S=t(36),O=t.n(S),P=t(9),D=t.n(P),K=t(182),C=t(139);!function(e){e.ConnectTimeout="ConnectTimeout",e.NeedOneKeyBridge="NeedOneKeyBridge"}(w||(w={}));var H=new(function(){function e(){k()(this,e),this.connectedDeviceType="classic",this.scanning=!1,this.tryCount=0}return O()(e,[{key:"getSDKInstance",value:function(){return D.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object(C.getHardwareSDKInstance)());case 1:case"end":return e.stop()}}),null,null,null,Promise)}},{key:"startDeviceScan",value:function(e){var n=this,t=function(){var t,r;return D.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,D.a.awrap(n.getSDKInstance());case 2:return t=a.sent,a.next=5,D.a.awrap(null==t?void 0:t.searchDevices());case 5:return r=a.sent,e(r),n.tryCount+=1,a.abrupt("return",r);case 9:case"end":return a.stop()}}),null,null,null,Promise)},r=function(){var e,a,u=arguments;return D.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:if(e=u.length>0&&void 0!==u[0]?u[0]:1e3,n.scanning){c.next=3;break}return c.abrupt("return");case 3:if(!(n.tryCount>15)){c.next=6;break}return n.stopScan(),c.abrupt("return");case 6:return c.next=8,D.a.awrap(t());case 8:if((a=c.sent).success){c.next=11;break}return c.abrupt("return",Promise.reject(a));case 11:return c.abrupt("return",new Promise((function(n){return setTimeout((function(){return n(r(1.5*e))}),e)})));case 12:case"end":return c.stop()}}),null,null,null,Promise)};this.scanning=!0,r()}},{key:"stopScan",value:function(){this.scanning=!1,this.tryCount=0}},{key:"connect",value:function(e){var n;return D.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,D.a.awrap(this.getFeatures(e));case 2:return n=t.sent,t.abrupt("return",null!==n);case 4:case"end":return t.stop()}}),null,this,null,Promise)}},{key:"getFeatures",value:function(e){var n,t;return D.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,D.a.awrap(this.getSDKInstance());case 2:return n=r.sent,r.next=5,D.a.awrap(null==n?void 0:n.getFeatures(e));case 5:if(!(t=r.sent).success){r.next=9;break}return this.connectedDeviceType=Object(K.getDeviceType)(t.payload),r.abrupt("return",t.payload);case 9:return r.abrupt("return",null);case 10:case"end":return r.stop()}}),null,this,null,Promise)}},{key:"getFeaturesWithError",value:function(e){var n,t,r;return D.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,D.a.awrap(this.getSDKInstance());case 2:return t=a.sent,a.next=5,D.a.awrap(null==t?void 0:t.getFeatures(e));case 5:if(!(r=a.sent).success){a.next=9;break}return this.connectedDeviceType=Object(K.getDeviceType)(r.payload),a.abrupt("return",r.payload);case 9:throw new Error(null!=(n=r.payload.error)?n:r.payload);case 10:case"end":return a.stop()}}),null,this,null,Promise)}},{key:"ensureConnected",value:function(e){var n,t,r,a=this;return D.a.async((function(u){for(;;)switch(u.prev=u.next){case 0:return n=0,t=!1,r=function(){var u,c,s=arguments;return D.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(u=s.length>0&&void 0!==s[0]?s[0]:1e3,!t){o.next=3;break}return o.abrupt("return",Promise.resolve({}));case 3:return n+=1,o.prev=4,o.next=7,D.a.awrap(a.getFeaturesWithError(e));case 7:if(!(c=o.sent)){o.next=13;break}return t=!0,o.next=12,D.a.awrap(Promise.resolve(c));case 12:return o.abrupt("return",o.sent);case 13:o.next=21;break;case 15:if(o.prev=15,o.t0=o.catch(4),console.log("feature \u62a5\u9519 ======== ========="),!o.t0.message.includes("device is not bonded")){o.next=20;break}return o.abrupt("return",Promise.reject(o.t0));case 20:console.log(o.t0);case 21:if(!(n>5)){o.next=23;break}return o.abrupt("return",Promise.reject(w.ConnectTimeout));case 23:return o.abrupt("return",new Promise((function(e){return setTimeout((function(){return e(r(1.5*u))}),u)})));case 24:case"end":return o.stop()}}),null,null,[[4,15]],Promise)},u.abrupt("return",r());case 4:case"end":return u.stop()}}),null,null,null,Promise)}}]),e}());function I(){var e=Object(a.useState)([]),n=g()(e,2),t=n[0],r=n[1],u=Object(a.useState)(null),c=g()(u,2);c[0],c[1];return Object(b.jsxs)(l.default,{children:[Object(b.jsx)(p.default,{title:"scan",onPress:function(){H.startDeviceScan((function(e){e.success?r(e.payload):r([])}))}}),Object(b.jsx)(f.default,{children:"\u8bbe\u5907\u5217\u8868"}),t.map((function(e){var n;return Object(b.jsx)(p.default,{title:null!=(n=e.connectId)?n:"",onPress:function(){return function(e){H.stopScan();try{var n;H.ensureConnected(null!=(n=e.connectId)?n:"")}catch(t){console.log(t)}}(e)}},e.connectId)}))]})}Object(C.getHardwareSDKInstance)();var T=Object(s.default)();Object(r.default)((function(){return Object(b.jsx)(c.default,{children:Object(b.jsxs)(T.Navigator,{initialRouteName:"Home",children:[Object(b.jsx)(T.Screen,{name:"Home",component:x}),Object(b.jsx)(T.Screen,{name:"Mock",component:I})]})})}))}},[[383,5,6]]]);
//# sourceMappingURL=app.cd9ba5f6.chunk.js.map